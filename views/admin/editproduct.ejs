<!DOCTYPE HTML>
<html lang="en">


<!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/page-form-product-2.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:33:32 GMT -->

<head>
    <meta charset="utf-8">
    <title> BOOK-SAW</title>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:title" content="">
    <meta property="og:type" content="">
    <meta property="og:url" content="">
    <meta property="og:image" content="">
    <!-- Favicon -->
    <link rel="shortcut icon" type="image/x-icon" href="/public/spellbook.png">
    <!-- Template CSS -->
    <link href="/public/admin-assets/css/main.css" rel="stylesheet" type="text/css" />

    <style>
        .image-item {
            position: relative;
            display: inline-block;
            margin-right: 10px;
        }

        .image-preview {
            position: relative;
        }

        .remove-btn {
            position: absolute;
            top: 100px;
            right: 8px;
            z-index: 1;
        }
    </style>


</head>

<body>
    <div class="screen-overlay"></div>

    <%-include('../partials/adminAside')-%>


        <main class="main-wrap">
            <%-include('../partials/adminHeader')-%>
                <form action="/admin/editProduct" method="post" enctype="multipart/form-data">


                    <section class="content-main">
                        <div class="row">
                            <div class="col-6">
                                <div class="content-header">
                                    <h2 class="content-title">Edit Product</h2>
                                    <div>
                                        <button class="btn btn-light rounded font-sm mr-5 text-body hover-up">Save to
                                            draft</button>
                                        <button class="btn btn-md rounded font-sm hover-up"
                                            type="submit">Update</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <h6>1. General info</h6>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Book Name</label>
                                                    <input type="text" name="Bookname" value="<%=product.Bookname%>"
                                                        placeholder="Type here" class="form-control">
                                                </div>
                                                <div class="mb-4">
                                                    <label class="form-label">Description</label>
                                                    <textarea placeholder="Type here" name="Description"
                                                        class="form-control"
                                                        rows="4"><%=product.Description%></textarea>
                                                </div>
                                                <div class="mb-4">
                                                    <label class="form-label">Categories</label>
                                                    <select class="form-select" name="Categories">
                                                        <option selected value="<%=product.Categories._id%>">
                                                            <%=product.Categories.categoryName%>
                                                        </option>

                                                        <% for(let i=0 ; i < categories.length ; i++) { %>
                                                            <option value="<%=categories[i]._id%>">
                                                                <%=categories[i].categoryName%>
                                                            </option>
                                                            <% } %>
                                                    </select>

                                                </div>
                                                <label class="form-label">Sub-Categories</label>

                                                <div>
                                                    <select class="form-select" name="subCategories">
                                                        <% if (product.subCategories && product.Categories) { %>
                                                            <option value="<%= product.subCategories._id %>">
                                                                <%=product.subCategories.subCategoryName%>
                                                            </option>
                                                        
                                                        <% } %>
                                                        <% for (let i = 0; i < subCat.length; i++) { %>
                                                            <option value="<%= subCat[i]._id %>">
                                                                <%= subCat[i].subCategoryName %>
                                                            </option>
                                                        <% } %>
                                                    </select>
                                                </div>
                                                

                                            </div> <!-- col.// -->
                                        </div> <!-- row.// -->
                                        <hr class="mb-4 mt-0">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <h6>2.Price</h6>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Cost in USD</label>
                                                    <input type="text" name="Regularprice" pattern="^[1-9][0-9]*(.[0-9]+)?$"
                                                    
                                                        value="<%=product.Regularprice%>" placeholder="$00.0"
                                                        class="form-control">
                                                </div>
                                            </div> <!-- col.// -->
                                            <div class="col-md-3">
                                                <h6>3. Offer Price</h6>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Cost in USD</label>
                                                    <input type="text" name="saleprice" pattern="^[1-9][0-9]*(.[0-9]+)?$"
                                                        value="<%=product.saleprice%>" placeholder="$00.0"
                                                        class="form-control">
                                                </div>
                                            </div>
                                            <div class="col-md-3">
                                                <h6>4. Stock</h6>
                                            </div>
                                            <div class="col-md-9">
                                                <div class="mb-4">
                                                    <label class="form-label">Stock</label>
                                                    <input type="text" name="stock" pattern="^[1-9][0-9]*(.[0-9]+)?$"
                                                        value="<%=product.stock%>" placeholder="0" class="form-control">
                                                </div>
                                            </div>
                                        </div> <!-- row.// -->
                                        <hr class="mb-4 mt-0">
                                        <div class="row">

                                        </div>
                                        <hr class="mb-4 mt-0">
                                        <div class="row">
                                            <div class="col-md-3">
                                                <h6>4. Media</h6>
                                            </div>





                                            <div class="card-body">
                                                <div class="input-upload">
                                                    <ul id="imageList" class="image-list">
                                                        <% product.Images.forEach((image)=> { %>
                                                            <li class="image-item">
                                                                <div class="image-preview">
                                                                    <img src="/public/uploads/<%=image%>"
                                                                        class="img-thumbnail" alt="Uploaded Image">
                                                                    <button class="btn btn-danger remove-btn"
                                                                        onclick="removeImage('<%= product._id %>','<%= image%>')">Remove</button>

                                                                </div>
                                                            </li>
                                                            <% }); %>
                                                    </ul>
                                                    <div id="previewContainer" class="mt-3"></div>
                                                    <div id="imagePreviewContainer" class="mt-3"></div>                                                    
                                                    <input id="imageInput" class="form-control" name="Images" type="file" accept="image/*" multiple onchange="handleImageSelection(event)">
                                            </div>




                                        </div> <!-- .row end// -->
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div>
                    </section> <!-- content-main end// -->
                </form>

                <footer class="main-footer font-xs">
                    <div class="row pb-30 pt-15">
                        <div class="col-sm-6">
                            <script>
                                document.write(new Date().getFullYear())
                            </script> ©,BOOK-SAW
                        </div>
                        <div class="col-sm-6">
                            <div class="text-sm-end">
                                All rights reserved
                            </div>
                        </div>
                    </div>
                </footer>
        </main>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

        <!-- <script>
        document.addEventListener('DOMContentLoaded', function() {
            const removeButtons = document.querySelectorAll('.remove-btn');
    
            removeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // Get the parent element of the button, which is the image item
                    const imageItem = button.closest('.image-item');
                    // Remove the image item from the list
                    imageItem.parentNode.removeChild(imageItem);
                });
            });
        });
    </script> -->
    <script>
        function validateImages(input) {
            const allowedExtensions = /(\.jpg|\.jpeg|\.png|\.webp)$/i;
        const files = input.files;
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            if (!allowedExtensions.test(file.name)) {
                toastr.error('Please select only image files (JPEG, JPG, PNG,.webp).');
                input.value = ''; //
                return false; // entry ila
            }
        }
        return true;
    }
    
    </script>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.querySelector("form[action='/admin/editProduct']");

                form.addEventListener("submit", function (event) {
                    const inputs = form.querySelectorAll("input[type='text'], textarea");
                    let isValid = true;

                    inputs.forEach(function (input) {
                        const trimmedValue = input.value.trim();
                        if (trimmedValue === "") {
                            isValid = false;
                            return;
                        }
                    });

                    if (!isValid) {
                        event.preventDefault();
                        toastr.warning("Please fill out all fields.");
                    }

                    const regularPriceInput = form.querySelector("input[name='Regularprice']");
                    const salePriceInput = form.querySelector("input[name='saleprice']");
                    const stockInput = form.querySelector("input[name='stock']");
                    const regex = /^\d+(\.\d+)?$/;

                    if (!regex.test(regularPriceInput.value) || !regex.test(salePriceInput.value) || !regex.test(stockInput.value)) {
                        event.preventDefault();
                        toastr.warning("Please enter valid numbers in Regular price, Sale price, and Stock fields.");
                    }

                    // const imagesInput = form.querySelector("input[name='Images']");
                    // if (imagesInput.files.length === 0) {
                    //     event.preventDefault();
                    //     toastr.warning("Please select at least one image.");
                    // }
                });
            });
        </script>


        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const form = document.querySelector("form[action='/admin/editProduct']");
                const regularPriceInput = form.querySelector("input[name='Regularprice']");
                const salePriceInput = form.querySelector("input[name='saleprice']");

                form.addEventListener("submit", function (event) {
                    const regularPrice = parseFloat(regularPriceInput.value);
                    const salePrice = parseFloat(salePriceInput.value);

                    if (salePrice > regularPrice) {
                        event.preventDefault(); // Prevent form submission
                        toastr.error("Regular price must be less than or equal to sale price."); // Display toastr error message
                    }
                });
            });
        </script>

        <script>
            async function removeImage(productid, filename) {
                event.preventDefault(); // Prevent form submission

                try {
                    const response = await fetch('/admin/removeImage', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ productid, filename })
                    });

                    if (response.ok) {
                        // If removal is successful, remove the corresponding image from the DOM
                        const data = await response.json();
                        const index = data.index;

                        // If removal is successful, remove the corresponding image from the DOM
                        const imageItems = document.querySelectorAll('.image-item');
                        if (imageItems[index]) {
                            imageItems[index].remove();
                        }
                    } else {
                        // Handle error response
                        console.error('Error removing image');
                    }
                } catch (error) {
                    console.error('Error removing image:', error);
                }
            }


        </script>

<script>
  function previewImages(event) {
  const previewContainer = document.getElementById('previewContainer');
  const imageList = document.getElementById('imageList');
  const files = event.target.files;

  // Clear previous previews
  imageList.innerHTML = '';

  for (let i = 0; i < files.length; i++) {
    const file = files[i];
    const reader = new FileReader();
    reader.onload = function () {
      const imgElement = document.createElement('img');
      imgElement.src = reader.result;
      imgElement.classList.add('img-thumbnail', 'mb-2');
      imgElement.style.maxWidth = '200px';

      const removeButton = document.createElement('button');
      removeButton.classList.add('btn', 'btn-danger', 'btn-sm', 'position-absolute', 'top-0', 'right-0', 'mt-2', 'mr-2');
      removeButton.style.zIndex = '1';
      removeButton.textContent = 'Remove';
      removeButton.onclick = () => {
        const fileIndex = Array.from(event.target.files).indexOf(file);
        if (fileIndex !== -1) {
          const dt = new DataTransfer();
          const files = Array.from(event.target.files);
          files.splice(fileIndex, 1);
          files.forEach((file) => dt.items.add(file));
          event.target.files = dt.files;
        }
        imgElement.parentElement.remove();
      };

      const imagePreview = document.createElement('div');
      imagePreview.classList.add('image-preview', 'position-relative');
      imagePreview.appendChild(imgElement);
      imagePreview.appendChild(removeButton);

      const listItem = document.createElement('li');
      listItem.classList.add('image-item');
      listItem.appendChild(imagePreview);
      imageList.appendChild(listItem);
    };
    reader.readAsDataURL(file);
  }
}

function handleImageSelection(event) {
  const imagePreviewContainer = document.getElementById('imagePreviewContainer');
  const fileInput = document.getElementById('imageInput');
  imagePreviewContainer.innerHTML = ''; // Clear previous previews

  if (!validateImages(fileInput)) {
        return; // Stop further processing if validation fails
    }

  const files = Array.from(event.target.files);

  for (const file of files) {
    const imagePreview = document.createElement('div');
    imagePreview.classList.add('image-preview', 'position-relative');

    const img = document.createElement('img');
    img.src = URL.createObjectURL(file);
    img.alt = file.name;
    img.classList.add('img-thumbnail', 'mb-2');
    img.style.maxWidth = '100px';

    const fileName = document.createElement('p');
    fileName.textContent = file.name;
    fileName.classList.add('text-muted', 'mb-0');

    const removeButton = document.createElement('button');
    removeButton.classList.add('btn', 'btn-danger', 'btn-sm', 'position-absolute', 'bottom-0', 'start-50', 'translate-middle-x', 'mb-2');
    removeButton.style.zIndex = '1';
    removeButton.textContent = 'Remove';
    removeButton.onclick = () => {
      const fileIndex = Array.from(fileInput.files).indexOf(file);
      if (fileIndex !== -1) {
        const dt = new DataTransfer();
        const files = Array.from(fileInput.files);
        files.splice(fileIndex, 1);
        files.forEach((file) => dt.items.add(file));
        fileInput.files = dt.files;
      }
      imagePreview.remove();
    };

    imagePreview.appendChild(img);
    imagePreview.appendChild(fileName);
    imagePreview.appendChild(removeButton);
    imagePreviewContainer.appendChild(imagePreview);
  }
}
</script>
        <script src="/public/admin-assets/js/vendors/jquery-3.6.0.min.js"></script>
        <script src="/public/admin-assets/js/vendors/bootstrap.bundle.min.js"></script>
        <script src="/public/admin-assets/js/vendors/select2.min.js"></script>
        <script src="/public/admin-assets/js/vendors/perfect-scrollbar.js"></script>
        <script src="/public/admin-assets/js/vendors/jquery.fullscreen.min.js"></script>
        <!-- Main Script -->
        <script src="/public/admin-assets/js/main.js" type="text/javascript"></script>
</body>


<!-- Mirrored from wp.alithemes.com/html/evara/evara-backend/page-form-product-2.html by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 01 Aug 2021 15:33:32 GMT -->

</html>